/* ══════════════════════════════════════════════════════════
   ChatGPT-Style Chatbot — Complete Stylesheet
   With Right Panel (Code Files + Features)
   ══════════════════════════════════════════════════════════ */

/* ── Design Tokens ── */
:root {
  --bg: #0d0d0d;
  --bg-sidebar: #171717;
  --bg-chat: #212121;
  --bg-input: #2f2f2f;
  --bg-hover: #2a2a2a;
  --bg-active: #343541;
  --bg-code: #1a1a2e;
  --bg-right: #1a1a1a;

  --surface: #1e1e1e;
  --surface-hover: #2a2a2a;
  --surface-active: #333;

  --border: #383838;
  --border-light: #2a2a2a;
  --border-focus: #6366f1;

  --text: #ececec;
  --text-secondary: #b4b4b4;
  --text-muted: #767676;
  --text-placeholder: #6b6b6b;

  --accent: #6366f1;
  --accent-hover: #818cf8;
  --accent-muted: rgba(99, 102, 241, 0.15);
  --accent-glow: rgba(99, 102, 241, 0.25);

  --green: #10b981;
  --green-muted: rgba(16, 185, 129, 0.15);
  --red: #ef4444;
  --red-muted: rgba(239, 68, 68, 0.15);
  --orange: #f59e0b;
  --orange-muted: rgba(245, 158, 11, 0.15);

  --radius: 12px;
  --radius-sm: 8px;
  --radius-lg: 16px;
  --radius-xl: 24px;

  --shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.4);

  --transition: 0.2s ease;
  --transition-fast: 0.15s ease;

  --sidebar-w: 260px;
  --right-panel-w: 380px;
  --header-h: 50px;
  --input-max-w: 768px;
  --chat-max-w: 768px;

  --font: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  --font-mono: 'JetBrains Mono', 'Fira Code', 'Cascadia Code', monospace;
}

/* ── Reset ── */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html, body { height: 100%; overflow: hidden; }
body {
  font-family: var(--font);
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
}
#root { height: 100%; }

/* ══════════════════════════════════════
   Layout: Sidebar | Chat | Right Panel
   ══════════════════════════════════════ */

.app-layout {
  display: flex;
  height: 100%;
  overflow: hidden;
}

/* ── Sidebar ── */
.sidebar {
  width: var(--sidebar-w);
  min-width: var(--sidebar-w);
  background: var(--bg-sidebar);
  display: flex;
  flex-direction: column;
  border-right: 1px solid var(--border-light);
  transition: transform var(--transition), width var(--transition), min-width var(--transition);
  overflow: hidden;
  z-index: 50;
}

.sidebar-header { padding: 10px; flex-shrink: 0; }

.new-chat-btn {
  display: flex; align-items: center; gap: 10px; width: 100%;
  padding: 10px 12px; border: 1px solid var(--border); border-radius: var(--radius);
  background: transparent; color: var(--text); font-family: var(--font);
  font-size: 13px; font-weight: 500; cursor: pointer;
  transition: background var(--transition-fast);
}
.new-chat-btn:hover { background: var(--bg-hover); }
.new-chat-btn svg { width: 16px; height: 16px; flex-shrink: 0; }

.conversations-list {
  flex: 1; overflow-y: auto; overflow-x: hidden; padding: 4px 6px;
  scrollbar-width: thin; scrollbar-color: var(--border) transparent;
}
.conversations-list::-webkit-scrollbar { width: 5px; }
.conversations-list::-webkit-scrollbar-track { background: transparent; }
.conversations-list::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

.conv-group-label {
  padding: 8px 8px 3px; font-size: 10px; font-weight: 600;
  color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;
}

.conv-item {
  display: flex; align-items: center; gap: 6px; width: 100%;
  padding: 8px 10px; border: none; border-radius: var(--radius-sm);
  background: transparent; color: var(--text-secondary); font-family: var(--font);
  font-size: 12.5px; cursor: pointer; text-align: left;
  transition: background var(--transition-fast), color var(--transition-fast);
  position: relative; overflow: hidden;
}
.conv-item:hover { background: var(--bg-hover); color: var(--text); }
.conv-item.active { background: var(--bg-active); color: var(--text); }

.conv-item-title { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; min-width: 0; }

.conv-item-delete {
  opacity: 0; width: 24px; height: 24px; border: none; border-radius: 5px;
  background: transparent; color: var(--text-muted); cursor: pointer;
  display: flex; align-items: center; justify-content: center; flex-shrink: 0;
  transition: opacity var(--transition-fast), background var(--transition-fast), color var(--transition-fast);
}
.conv-item:hover .conv-item-delete { opacity: 1; }
.conv-item-delete:hover { background: var(--red-muted); color: var(--red); }

.sidebar-footer { padding: 10px; border-top: 1px solid var(--border-light); flex-shrink: 0; }
.sidebar-footer-info { font-size: 11px; color: var(--text-muted); text-align: center; line-height: 1.4; }
.sidebar-footer-info span { color: var(--accent); font-weight: 500; }

/* ── Main Chat Area ── */
.chat-main {
  flex: 1; display: flex; flex-direction: column;
  min-width: 0; height: 100%; overflow: hidden; background: var(--bg-chat);
}

.chat-header {
  height: var(--header-h); min-height: var(--header-h);
  display: flex; align-items: center; padding: 0 12px; gap: 8px;
  border-bottom: 1px solid var(--border-light); background: var(--bg-chat); z-index: 10;
}

.sidebar-toggle-btn, .right-panel-toggle-btn {
  width: 36px; height: 36px; border: none; border-radius: var(--radius-sm);
  background: transparent; color: var(--text-secondary); cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: background var(--transition-fast), color var(--transition-fast); flex-shrink: 0;
}
.sidebar-toggle-btn:hover, .right-panel-toggle-btn:hover {
  background: var(--bg-hover); color: var(--text);
}
.sidebar-toggle-btn svg, .right-panel-toggle-btn svg { width: 18px; height: 18px; }

.header-title {
  flex: 1; text-align: center; font-size: 14px; font-weight: 600;
  color: var(--text); letter-spacing: -0.01em;
}

.header-model-badge {
  font-size: 10px; padding: 2px 7px; border-radius: 20px;
  background: var(--accent-muted); color: var(--accent); font-weight: 500;
}

/* Messages scroll */
.messages-scroll {
  flex: 1; overflow-y: auto; overflow-x: hidden;
  -webkit-overflow-scrolling: touch; scrollbar-width: thin;
  scrollbar-color: var(--border) transparent; scroll-behavior: smooth;
}
.messages-scroll::-webkit-scrollbar { width: 7px; }
.messages-scroll::-webkit-scrollbar-track { background: transparent; }
.messages-scroll::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
.messages-scroll::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

.messages-container {
  max-width: var(--chat-max-w); margin: 0 auto; padding: 16px 20px 0; width: 100%;
}

/* ── Welcome Screen ── */
.welcome-screen {
  display: flex; flex-direction: column; align-items: center;
  justify-content: center; min-height: 100%; padding: 32px 20px;
}
.welcome-logo {
  width: 48px; height: 48px; border-radius: 50%;
  background: linear-gradient(135deg, var(--accent) 0%, #a855f7 100%);
  display: flex; align-items: center; justify-content: center;
  margin-bottom: 16px; box-shadow: 0 0 24px var(--accent-glow);
}
.welcome-logo svg { width: 24px; height: 24px; color: white; }
.welcome-title { font-size: 22px; font-weight: 700; color: var(--text); margin-bottom: 6px; letter-spacing: -0.02em; }
.welcome-subtitle {
  font-size: 14px; color: var(--text-secondary); margin-bottom: 28px;
  text-align: center; max-width: 420px; line-height: 1.5;
}
.suggestions-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; max-width: 520px; width: 100%; }
.suggestion-btn {
  display: flex; align-items: flex-start; gap: 10px; padding: 12px 14px;
  border: 1px solid var(--border); border-radius: var(--radius);
  background: var(--surface); color: var(--text-secondary);
  font-family: var(--font); font-size: 12.5px; line-height: 1.4;
  text-align: left; cursor: pointer;
  transition: border-color var(--transition-fast), background var(--transition-fast), color var(--transition-fast);
}
.suggestion-btn:hover { border-color: var(--accent); background: var(--accent-muted); color: var(--text); }
.suggestion-icon { width: 18px; height: 18px; flex-shrink: 0; color: var(--accent); margin-top: 1px; }

@media (max-width: 600px) { .suggestions-grid { grid-template-columns: 1fr; } }

/* ══════════════════════════════════════
   Messages
   ══════════════════════════════════════ */

.message { display: flex; gap: 12px; padding: 16px 0; align-items: flex-start; }
.message + .message { border-top: 1px solid rgba(255,255,255,0.04); }

.msg-avatar {
  width: 30px; height: 30px; border-radius: 50%; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  font-size: 12px; font-weight: 600;
}
.message.user .msg-avatar { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: white; }
.message.assistant .msg-avatar { background: linear-gradient(135deg, #10b981 0%, #06b6d4 100%); color: white; }
.msg-avatar svg { width: 16px; height: 16px; }

.msg-body { flex: 1; min-width: 0; overflow-wrap: break-word; }
.msg-role { font-size: 12px; font-weight: 600; margin-bottom: 3px; color: var(--text); }

/* ── Inline Preview in Chat ── */
.msg-preview-section {
  margin-top: 10px; border: 1px solid var(--border); border-radius: var(--radius);
  overflow: hidden; background: var(--surface);
}
.msg-preview-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 6px 10px; background: var(--bg-hover);
  border-bottom: 1px solid var(--border); font-size: 11px;
}
.msg-preview-label { color: var(--text-muted); font-weight: 500; }
.msg-preview-actions { display: flex; gap: 4px; }
.msg-preview-actions button {
  padding: 3px 8px; border: 1px solid var(--border); border-radius: 5px;
  background: transparent; color: var(--text-secondary); font-size: 11px;
  font-family: var(--font); cursor: pointer;
  transition: background var(--transition-fast), color var(--transition-fast);
}
.msg-preview-actions button:hover { background: var(--accent-muted); color: var(--accent); }
.msg-preview-actions .expand-btn {
  background: var(--accent-muted); color: var(--accent); border-color: var(--accent);
  font-weight: 600;
}
.msg-preview-actions .expand-btn:hover { background: var(--accent); color: #fff; }
.msg-preview-iframe {
  width: 100%; height: 260px; border: none; background: #fff; display: block;
}
.msg-preview-fallback {
  padding: 16px; color: var(--text-muted); font-size: 12px; text-align: center;
  min-height: 80px; display: flex; align-items: center; justify-content: center;
}

/* ── Fullscreen Preview Modal ── */
.preview-modal-overlay {
  position: fixed; inset: 0; z-index: 9999;
  background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(4px);
  display: flex; align-items: center; justify-content: center;
  animation: fadeIn 0.15s ease;
}
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

.preview-modal {
  width: 96vw; height: 94vh; max-width: 1400px;
  background: var(--bg-chat); border: 1px solid var(--border);
  border-radius: var(--radius); display: flex; flex-direction: column;
  overflow: hidden; box-shadow: 0 24px 80px rgba(0,0,0,0.6);
  animation: modalSlide 0.2s ease;
}
/* Multi-variant modal: go full width for maximum iframe space */
.preview-modal--multi {
  width: 100vw; height: 100vh; max-width: none;
  border-radius: 0; border: none;
}
/* Single variant modal: generous size */
.preview-modal--single {
  width: 96vw; height: 94vh; max-width: 1200px;
}
@keyframes modalSlide { from { opacity: 0; transform: scale(0.96) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }

.preview-modal-toolbar {
  display: flex; align-items: center; gap: 12px;
  padding: 6px 16px; background: var(--bg-sidebar);
  border-bottom: 1px solid var(--border); flex-shrink: 0;
  min-height: 38px;
}
.preview-modal-title {
  font-size: 13px; font-weight: 600; color: var(--text); margin-right: auto;
}
.preview-modal-viewport-btns {
  display: flex; gap: 4px;
}
.viewport-btn {
  padding: 4px 10px; border: 1px solid var(--border); border-radius: 5px;
  background: transparent; color: var(--text-muted); font-size: 13px;
  cursor: pointer; transition: all var(--transition-fast);
}
.viewport-btn:hover { background: var(--bg-hover); color: var(--text); }
.viewport-btn.active { background: var(--accent-muted); border-color: var(--accent); color: var(--accent); }

.preview-modal-actions {
  display: flex; gap: 6px; align-items: center;
}
.preview-modal-actions button {
  padding: 5px 12px; border: 1px solid var(--border); border-radius: 6px;
  background: var(--surface); color: var(--text-secondary); font-size: 12px;
  font-family: var(--font); cursor: pointer;
  transition: all var(--transition-fast);
}
.preview-modal-actions button:hover { background: var(--accent-muted); color: var(--accent); border-color: var(--accent); }
.preview-modal-close {
  font-size: 16px !important; padding: 4px 10px !important;
  font-weight: 700; line-height: 1;
}
.preview-modal-close:hover { background: var(--red-muted) !important; color: var(--red) !important; border-color: var(--red) !important; }

.preview-modal-viewport-label {
  text-align: center; font-size: 10px; color: var(--text-muted);
  padding: 2px 0; background: var(--bg); border-bottom: 1px solid var(--border-light);
  flex-shrink: 0; line-height: 1.4;
}

.preview-modal-body {
  flex: 1; position: relative; overflow: hidden;
  background: #f5f5f5; min-height: 0;
}
.preview-modal-loading {
  position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
  color: var(--text-muted); font-size: 14px; z-index: 1;
  background: var(--bg-chat);
}
.preview-modal-iframe-wrap {
  width: 100%; height: 100%;
  transition: max-width 0.3s ease;
}
.preview-modal-iframe {
  width: 100%; height: 100%; border: none; background: #fff; display: block;
  transition: opacity 0.2s ease;
}

/* Multi-variant modal layout */
.preview-modal-multi-body {
  flex: 1; display: flex; overflow: hidden; background: #f5f5f5;
  min-height: 0;
}
.preview-modal-variant-pane {
  flex: 1; display: flex; flex-direction: column; min-width: 0;
  border-right: 2px solid var(--border);
}
.preview-modal-variant-pane:last-child { border-right: none; }
.preview-modal-variant-label {
  display: flex; align-items: center; justify-content: space-between;
  padding: 4px 10px; background: var(--bg-code);
  border-bottom: 1px solid var(--border); font-size: 11px;
  color: var(--accent); font-weight: 600; flex-shrink: 0;
  min-height: 28px;
}
.preview-modal-variant-label span {
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis; min-width: 0;
}
.preview-modal-variant-label button {
  padding: 2px 7px; border: 1px solid var(--border); border-radius: 4px;
  background: transparent; color: var(--text-secondary); font-size: 10px;
  font-family: var(--font); cursor: pointer; flex-shrink: 0;
  transition: all var(--transition-fast);
}
.preview-modal-variant-label button:hover { background: var(--accent-muted); color: var(--accent); }
.preview-modal-variant-iframe-area {
  flex: 1; position: relative; overflow: hidden; min-height: 0;
}
.preview-modal-variant-iframe-area .preview-modal-loading {
  position: absolute; inset: 0;
}
.preview-modal-variant-iframe-area .preview-modal-iframe {
  width: 100%; height: 100%; min-height: 0;
}

/* ── Multi-Preview (side-by-side variants) ── */
.multi-preview-section {
  margin-top: 10px; border: 1px solid var(--border); border-radius: var(--radius);
  overflow: hidden; background: var(--surface);
}
.multi-preview-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 6px 10px; background: var(--bg-hover);
  border-bottom: 1px solid var(--border); font-size: 11px;
}
.multi-preview-grid {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 0;
}
.multi-preview-card {
  border-right: 1px solid var(--border);
  min-width: 0;
  overflow: hidden;
}
.multi-preview-card:last-child { border-right: none; }
.multi-preview-card-label {
  display: flex; align-items: center; justify-content: space-between;
  padding: 3px 8px; background: var(--bg-code); font-size: 11px;
  color: var(--accent); font-weight: 600; border-bottom: 1px solid var(--border-light);
  min-height: 24px;
}
.multi-preview-card-actions { display: flex; gap: 4px; }
.multi-preview-card-label button, .multi-preview-card-actions button {
  padding: 2px 6px; border: 1px solid var(--border); border-radius: 4px;
  background: transparent; color: var(--text-secondary); font-size: 10px;
  font-family: var(--font); cursor: pointer;
  transition: all var(--transition-fast);
}
.multi-preview-card-label button:hover, .multi-preview-card-actions button:hover { background: var(--accent-muted); color: var(--accent); }
.multi-preview-card .msg-preview-section {
  margin-top: 0; border: none; border-radius: 0;
}
.multi-preview-card .msg-preview-header { display: none; }
.multi-preview-card .msg-preview-iframe { height: 300px; }

/* Code used section */
.msg-code-section { border-top: 1px solid var(--border); }
.msg-code-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 5px 10px; font-size: 11px; color: var(--text-muted);
  cursor: pointer; transition: background var(--transition-fast);
}
.msg-code-header:hover { background: var(--bg-hover); }
.msg-code-header span { font-weight: 500; }
.msg-code-pre {
  margin: 0; padding: 10px 12px; font-family: var(--font-mono); font-size: 11.5px;
  line-height: 1.45; overflow-x: auto; max-height: 200px; overflow-y: auto;
  white-space: pre; color: var(--text); background: #0d1117;
  border-top: 1px solid var(--border-light);
}

/* ── Markdown Content ── */
.markdown-content { font-size: 14px; line-height: 1.65; color: var(--text); }
.markdown-content p { margin-bottom: 10px; }
.markdown-content p:last-child { margin-bottom: 0; }
.markdown-content h1, .markdown-content h2, .markdown-content h3,
.markdown-content h4, .markdown-content h5, .markdown-content h6 {
  color: var(--text); margin: 16px 0 6px; font-weight: 600; letter-spacing: -0.01em;
}
.markdown-content h1 { font-size: 1.4em; }
.markdown-content h2 { font-size: 1.25em; }
.markdown-content h3 { font-size: 1.1em; }
.markdown-content strong { color: var(--text); font-weight: 600; }
.markdown-content em { font-style: italic; }
.markdown-content a { color: var(--accent); text-decoration: none; }
.markdown-content a:hover { text-decoration: underline; }
.markdown-content ul, .markdown-content ol { margin: 6px 0 10px; padding-left: 22px; }
.markdown-content li { margin-bottom: 3px; }
.markdown-content li > p { margin-bottom: 3px; }
.markdown-content blockquote {
  border-left: 3px solid var(--accent); padding: 6px 14px; margin: 10px 0;
  background: var(--accent-muted); border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
  color: var(--text-secondary);
}
.markdown-content hr { border: none; border-top: 1px solid var(--border); margin: 16px 0; }
.markdown-content table { border-collapse: collapse; width: 100%; margin: 10px 0; font-size: 13px; }
.markdown-content th, .markdown-content td { border: 1px solid var(--border); padding: 6px 10px; text-align: left; }
.markdown-content th { background: var(--surface); font-weight: 600; }
.markdown-content code:not(pre code) {
  background: var(--bg-input); padding: 1px 5px; border-radius: 4px;
  font-family: var(--font-mono); font-size: 0.85em; color: #e8b4b8;
  border: 1px solid var(--border-light);
}

/* Code blocks */
.code-block-wrapper {
  position: relative; margin: 10px 0; border-radius: var(--radius);
  overflow: hidden; border: 1px solid var(--border); background: #0d1117;
}
.code-block-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 5px 10px; background: #161b22;
  border-bottom: 1px solid var(--border-light); font-size: 11px;
}
.code-lang-label { color: var(--text-muted); font-family: var(--font-mono); font-size: 11px; text-transform: lowercase; }
.copy-code-btn {
  display: flex; align-items: center; gap: 4px; padding: 3px 8px;
  border: none; border-radius: 5px; background: transparent;
  color: var(--text-secondary); font-family: var(--font); font-size: 11px; cursor: pointer;
  transition: background var(--transition-fast), color var(--transition-fast);
}
.copy-code-btn:hover { background: rgba(255,255,255,0.1); color: var(--text); }
.copy-code-btn.copied { color: var(--green); }
.copy-code-btn svg { width: 13px; height: 13px; }
.markdown-content pre {
  margin: 0; padding: 12px; overflow-x: auto; overflow-y: auto;
  max-height: 280px; font-family: var(--font-mono);
  font-size: 12px; line-height: 1.5; background: #0d1117;
  scrollbar-width: thin; scrollbar-color: var(--border) transparent;
}
.markdown-content pre::-webkit-scrollbar { height: 5px; }
.markdown-content pre::-webkit-scrollbar-track { background: transparent; }
.markdown-content pre::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
.markdown-content pre code { background: none; padding: 0; border: none; font-size: inherit; color: inherit; }

.message.user .msg-content { font-size: 14px; line-height: 1.55; white-space: pre-wrap; color: var(--text); }

/* Streaming cursor */
.streaming-cursor {
  display: inline-block; width: 2px; height: 1em; background: var(--accent);
  margin-left: 2px; vertical-align: text-bottom; animation: blink 1s step-end infinite;
}
@keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

/* Typing indicator */
.typing-indicator { display: flex; gap: 4px; padding: 6px 0; }
.typing-dot {
  width: 7px; height: 7px; border-radius: 50%; background: var(--text-muted);
  animation: typing 1.4s ease-in-out infinite;
}
.typing-dot:nth-child(2) { animation-delay: 0.2s; }
.typing-dot:nth-child(3) { animation-delay: 0.4s; }
@keyframes typing { 0%, 60%, 100% { transform: translateY(0); opacity: 0.4; } 30% { transform: translateY(-5px); opacity: 1; } }

/* ══════════════════════════════════════
   Input Area
   ══════════════════════════════════════ */

.input-area { flex-shrink: 0; padding: 12px 20px 16px; background: var(--bg-chat); }
.input-wrapper { max-width: var(--input-max-w); margin: 0 auto; position: relative; }
.input-box {
  display: flex; align-items: flex-end; gap: 8px;
  padding: 8px 10px 8px 14px; background: var(--bg-input);
  border: 1px solid var(--border); border-radius: var(--radius-xl);
  transition: border-color var(--transition), box-shadow var(--transition);
}
.input-box:focus-within { border-color: var(--accent); box-shadow: 0 0 0 2px var(--accent-muted); }
.input-box textarea {
  flex: 1; min-height: 22px; max-height: 180px; padding: 4px 0;
  border: none; background: transparent; color: var(--text);
  font-family: var(--font); font-size: 14px; line-height: 1.45; resize: none; outline: none;
}
.input-box textarea::placeholder { color: var(--text-placeholder); }

.send-btn {
  width: 34px; height: 34px; border: none; border-radius: 50%;
  background: var(--accent); color: white; cursor: pointer;
  display: flex; align-items: center; justify-content: center; flex-shrink: 0;
  transition: background var(--transition-fast), opacity var(--transition-fast), transform 0.1s;
}
.send-btn:hover:not(:disabled) { background: var(--accent-hover); }
.send-btn:active:not(:disabled) { transform: scale(0.94); }
.send-btn:disabled { opacity: 0.4; cursor: not-allowed; }
.send-btn svg { width: 16px; height: 16px; }

.stop-btn {
  width: 34px; height: 34px; border: 2px solid var(--text-secondary); border-radius: 50%;
  background: transparent; color: var(--text-secondary); cursor: pointer;
  display: flex; align-items: center; justify-content: center; flex-shrink: 0;
  transition: border-color var(--transition-fast), color var(--transition-fast);
}
.stop-btn:hover { border-color: var(--text); color: var(--text); }
.stop-btn .stop-icon { width: 11px; height: 11px; background: currentColor; border-radius: 2px; }

.input-hint { text-align: center; font-size: 10.5px; color: var(--text-muted); margin-top: 6px; }

/* ══════════════════════════════════════
   RIGHT PANEL (Code Files + Features)
   ══════════════════════════════════════ */

.right-panel {
  width: var(--right-panel-w);
  min-width: var(--right-panel-w);
  background: var(--bg-right);
  border-left: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  /* no width transition so drag is instant */
  transition: opacity var(--transition);
}

.right-panel.closed {
  width: 0; min-width: 0; border: none; overflow: hidden; opacity: 0; pointer-events: none;
}

/* Resize handle between chat and right panel (draggable) */
.resize-handle {
  width: 6px; min-width: 6px; background: var(--border-light); cursor: col-resize;
  flex-shrink: 0; transition: background var(--transition);
  position: relative;
}
.resize-handle::after {
  content: ''; position: absolute; top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  width: 2px; height: 32px; border-radius: 2px;
  background: var(--text-muted); opacity: 0;
  transition: opacity var(--transition-fast);
}
.resize-handle:hover { background: var(--accent); }
.resize-handle:hover::after { opacity: 1; background: white; }
.resize-handle.hidden { display: none; }

/* ── Code Panel (top half) ── */
.code-panel {
  flex: 1; display: flex; flex-direction: column;
  border-bottom: 1px solid var(--border); min-height: 0; overflow: hidden;
}
.code-panel-header {
  padding: 10px 12px; display: flex; align-items: center;
  justify-content: space-between; border-bottom: 1px solid var(--border-light);
  flex-shrink: 0;
}
.code-panel-header h3 { font-size: 13px; font-weight: 600; color: var(--text); }
.code-panel-header-actions { display: flex; align-items: center; gap: 6px; }
.code-panel-header .code-count {
  font-size: 10px; padding: 2px 6px; border-radius: 10px;
  background: var(--accent-muted); color: var(--accent); font-weight: 500;
}
.code-clear-btn {
  padding: 2px 8px; border: 1px solid var(--border); border-radius: 5px;
  background: transparent; color: var(--text-muted); font-size: 10px;
  font-family: var(--font); cursor: pointer;
  transition: all var(--transition-fast);
}
.code-clear-btn:hover { background: rgba(249,68,56,0.1); color: #F04438; border-color: #F04438; }
.code-panel-body { flex: 1; overflow-y: auto; padding: 8px; min-height: 0; }
.code-panel-body::-webkit-scrollbar { width: 5px; }
.code-panel-body::-webkit-scrollbar-track { background: transparent; }
.code-panel-body::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

/* Folder grouping */
.code-folder { margin-bottom: 4px; }
.code-folder-header {
  display: flex; align-items: center; gap: 5px; padding: 5px 6px;
  cursor: pointer; border-radius: var(--radius-sm); font-size: 11px;
  color: var(--text-secondary); font-weight: 600; user-select: none;
  transition: background var(--transition-fast);
}
.code-folder-header:hover { background: var(--bg-hover); }
.code-folder-arrow {
  font-size: 8px; transition: transform 0.15s ease; display: inline-block;
}
.code-folder-arrow.collapsed { transform: rotate(-90deg); }
.code-folder-icon { font-size: 13px; }
.code-folder-name { flex: 1; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.code-folder-count {
  font-size: 9px; padding: 1px 5px; border-radius: 8px;
  background: var(--bg-hover); color: var(--text-muted); font-weight: 500;
}

.code-file-item {
  display: flex; align-items: center; gap: 8px; width: 100%;
  padding: 6px 10px 6px 24px; border: 1px solid transparent; border-radius: var(--radius-sm);
  background: transparent; color: var(--text-secondary); font-family: var(--font);
  font-size: 12px; cursor: pointer; text-align: left;
  transition: background var(--transition-fast), border-color var(--transition-fast), color var(--transition-fast);
  margin-bottom: 2px; position: relative;
}
.code-file-item:hover { background: var(--bg-hover); border-color: var(--border); color: var(--text); }
.code-file-item.active { background: var(--accent-muted); border-color: var(--accent); color: var(--text); }
.code-file-icon { color: var(--accent); flex-shrink: 0; }
.code-file-icon svg { width: 14px; height: 14px; }
.code-file-info { flex: 1; min-width: 0; }
.code-file-name { font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.code-file-meta { display: flex; align-items: center; gap: 6px; font-size: 10px; color: var(--text-muted); margin-top: 1px; }
.code-file-context {
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 120px;
  color: var(--text-muted); opacity: 0.7; font-style: italic;
}
.code-file-delete {
  flex-shrink: 0; width: 18px; height: 18px; border: none; border-radius: 4px;
  background: transparent; color: var(--text-muted); cursor: pointer;
  font-size: 11px; display: flex; align-items: center; justify-content: center;
  opacity: 0; transition: all var(--transition-fast);
}
.code-file-item:hover .code-file-delete { opacity: 1; }
.code-file-delete:hover { background: rgba(249,68,56,0.15); color: #F04438; }

.code-viewer {
  margin-top: 8px; border: 1px solid var(--border); border-radius: var(--radius-sm);
  overflow: hidden; background: #0d1117;
}
.code-viewer-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 5px 10px; background: #161b22; border-bottom: 1px solid var(--border-light);
}
.code-viewer-header span { font-size: 11px; color: var(--text-muted); font-weight: 500; }
.code-viewer-actions { display: flex; gap: 4px; }
.code-viewer-header button, .code-viewer-actions button {
  padding: 3px 8px; border: 1px solid var(--border); border-radius: 5px;
  background: transparent; color: var(--text-secondary); font-size: 10px;
  font-family: var(--font); cursor: pointer;
  transition: background var(--transition-fast), color var(--transition-fast);
}
.code-viewer-header button:hover, .code-viewer-actions button:hover { background: var(--accent-muted); color: var(--accent); }
.code-viewer-delete:hover { background: rgba(249,68,56,0.15) !important; color: #F04438 !important; border-color: #F04438 !important; }
.code-viewer pre {
  margin: 0; padding: 10px; font-family: var(--font-mono); font-size: 11px;
  line-height: 1.45; overflow: auto; max-height: 180px; color: var(--text);
  white-space: pre; background: #0d1117;
}

.code-panel-empty {
  padding: 20px 12px; text-align: center; color: var(--text-muted); font-size: 12px;
}

/* ── Features Panel (bottom half) ── */
.features-panel {
  flex: 1; display: flex; flex-direction: column; min-height: 0; overflow: hidden;
}

.features-tabs {
  display: flex; border-bottom: 1px solid var(--border); flex-shrink: 0;
}
.features-tab {
  flex: 1; padding: 8px 6px; border: none; border-bottom: 2px solid transparent;
  background: transparent; color: var(--text-muted); font-family: var(--font);
  font-size: 11.5px; font-weight: 500; cursor: pointer; text-align: center;
  transition: color var(--transition-fast), border-color var(--transition-fast), background var(--transition-fast);
}
.features-tab:hover { color: var(--text-secondary); background: var(--bg-hover); }
.features-tab.active { color: var(--accent); border-bottom-color: var(--accent); }

.features-body { flex: 1; overflow-y: auto; padding: 12px; min-height: 0; }
.features-body::-webkit-scrollbar { width: 5px; }
.features-body::-webkit-scrollbar-track { background: transparent; }
.features-body::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

/* ── Shortcut hint ── */
.shortcut-hint {
  font-size: 11px; color: var(--text-muted); margin-bottom: 10px;
  padding: 6px 8px; background: var(--accent-muted); border-radius: var(--radius-sm);
  border-left: 3px solid var(--accent); line-height: 1.4;
}

/* ── Shortcut button grid ── */
.shortcut-group { margin-bottom: 14px; }
.shortcut-group-label {
  font-size: 10.5px; font-weight: 600; color: var(--text-secondary);
  text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;
}
.shortcut-grid {
  display: flex; flex-wrap: wrap; gap: 5px;
}
.shortcut-btn {
  padding: 5px 10px; border: 1px solid var(--border); border-radius: 16px;
  background: var(--surface); color: var(--text-secondary);
  font-family: var(--font); font-size: 11px; font-weight: 500;
  cursor: pointer; white-space: nowrap;
  transition: all var(--transition-fast);
}
.shortcut-btn:hover:not(:disabled) {
  background: var(--accent-muted); border-color: var(--accent);
  color: var(--accent); transform: translateY(-1px);
}
.shortcut-btn:active:not(:disabled) { transform: translateY(0); }
.shortcut-btn:disabled { opacity: 0.4; cursor: not-allowed; }

/* Feature elements (reused in Variants tab) */
.feature-section { margin-bottom: 12px; }
.feature-label { font-size: 11.5px; font-weight: 500; color: var(--text-secondary); margin-bottom: 5px; }
.feature-row { display: flex; gap: 6px; margin-top: 6px; align-items: center; flex-wrap: wrap; }

.feature-btn {
  padding: 7px 14px; border: none; border-radius: var(--radius-sm);
  font-family: var(--font); font-size: 12px; font-weight: 500;
  cursor: pointer; transition: background var(--transition-fast), opacity var(--transition-fast);
}
.feature-btn:disabled { opacity: 0.5; cursor: not-allowed; }
.feature-btn-primary { background: var(--accent); color: white; }
.feature-btn-primary:hover:not(:disabled) { background: var(--accent-hover); }

/* Variant keywords */
.variant-keyword-row { display: flex; gap: 6px; margin-top: 6px; align-items: center; }
.variant-keyword-row label { font-size: 11px; color: var(--text-muted); min-width: 30px; }
.variant-keyword-row input {
  flex: 1; padding: 5px 8px; border: 1px solid var(--border); border-radius: 5px;
  background: var(--bg-input); color: var(--text); font-size: 11.5px; outline: none;
  transition: border-color var(--transition);
}
.variant-keyword-row input:focus { border-color: var(--accent); }

/* Catalog list */
.catalog-mini-list { display: flex; flex-direction: column; gap: 4px; }
.catalog-mini-item {
  padding: 7px 10px; border: 1px solid var(--border-light); border-radius: var(--radius-sm);
  background: transparent; font-size: 12px;
  transition: border-color var(--transition-fast), background var(--transition-fast);
}
.catalog-mini-item:hover { border-color: var(--border); background: var(--bg-hover); }
.catalog-mini-item.clickable { cursor: pointer; }
.catalog-mini-item.clickable:hover { border-color: var(--accent); background: var(--accent-muted); }
.catalog-mini-name { font-weight: 500; color: var(--text); }
.catalog-mini-path { font-size: 10px; color: var(--accent); font-family: var(--font-mono); word-break: break-all; margin-top: 2px; }
.catalog-mini-desc { font-size: 10.5px; color: var(--text-muted); margin-top: 2px; }

/* Spinner */
.spinner {
  display: inline-block; width: 14px; height: 14px; border: 2px solid var(--border);
  border-top-color: var(--accent); border-radius: 50%;
  animation: spin 0.6s linear infinite; vertical-align: middle; margin-right: 5px;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* ══════════════════════════════════════
   Toast
   ══════════════════════════════════════ */

.toast-container { position: fixed; top: 16px; right: 16px; z-index: 1000; display: flex; flex-direction: column; gap: 6px; }
.toast {
  padding: 10px 16px; border-radius: var(--radius-sm); font-size: 13px;
  background: var(--surface); border: 1px solid var(--border); color: var(--text);
  box-shadow: var(--shadow-lg); animation: toast-in 0.3s ease; max-width: 320px;
}
.toast.error { border-color: var(--red); color: #fca5a5; }
.toast.success { border-color: var(--green); color: #a7f3d0; }
@keyframes toast-in { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }

/* ══════════════════════════════════════
   Mobile Responsive
   ══════════════════════════════════════ */

@media (max-width: 768px) {
  .sidebar {
    position: fixed; top: 0; left: 0; bottom: 0;
    transform: translateX(-100%); z-index: 200; box-shadow: var(--shadow-lg);
  }
  .sidebar.open { transform: translateX(0); }
  .sidebar-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 199;
    animation: fade-in 0.2s ease;
  }
  @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
  .right-panel, .resize-handle { display: none !important; }
  .messages-container { padding: 12px 12px 0; }
  .input-area { padding: 10px 12px 14px; }
  .suggestions-grid { grid-template-columns: 1fr; }
  .welcome-title { font-size: 18px; }
}

@media (min-width: 769px) {
  .sidebar.hidden-desktop { width: 0; min-width: 0; padding: 0; border: none; overflow: hidden; }
}

/* ══════════════════════════════════════
   Utility
   ══════════════════════════════════════ */

.sr-only {
  position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
  overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0;
}
.markdown-content img { max-width: 100%; height: auto; border-radius: var(--radius-sm); }
::selection { background: var(--accent-muted); color: var(--text); }

/* ══════════════════════════════════════
   Agent Pipeline Visualization
   ══════════════════════════════════════ */

.agent-pipeline {
  padding: 14px 20px;
  background: linear-gradient(180deg, rgba(30,30,30,0.95) 0%, rgba(33,33,33,0.85) 100%);
  border-bottom: 1px solid var(--border-light);
  animation: pipeline-slide-in 0.3s ease;
  overflow: hidden;
}
@keyframes pipeline-slide-in {
  from { max-height: 0; opacity: 0; padding: 0 20px; }
  to { max-height: 120px; opacity: 1; }
}

.agent-pipeline-label {
  font-size: 10px;
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.06em;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 6px;
}
.agent-pipeline-label .pipeline-dot {
  width: 6px; height: 6px; border-radius: 50%;
  background: var(--accent);
  animation: pipeline-pulse 1.5s ease-in-out infinite;
}
@keyframes pipeline-pulse {
  0%, 100% { opacity: 0.4; transform: scale(1); }
  50% { opacity: 1; transform: scale(1.3); }
}

.agent-pipeline-track {
  display: flex;
  align-items: center;
  gap: 0;
  max-width: 660px;
  margin: 0 auto;
}

.agent-node {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 5px;
  min-width: 72px;
  position: relative;
}

.agent-node-circle {
  width: 32px; height: 32px;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 13px;
  border: 2px solid var(--border);
  background: var(--surface);
  color: var(--text-muted);
  transition: all 0.4s ease;
  position: relative;
  z-index: 2;
}

.agent-node-label {
  font-size: 10px;
  font-weight: 500;
  color: var(--text-muted);
  white-space: nowrap;
  transition: color 0.3s ease;
}

/* Pending state */
.agent-node.pending .agent-node-circle {
  border-color: var(--border);
  background: var(--surface);
  color: var(--text-muted);
}

/* Active state */
.agent-node.active .agent-node-circle {
  border-color: var(--accent);
  background: var(--accent-muted);
  color: var(--accent);
  box-shadow: 0 0 16px var(--accent-glow), 0 0 4px var(--accent-muted);
  animation: agent-active-pulse 2s ease-in-out infinite;
}
.agent-node.active .agent-node-label {
  color: var(--accent);
  font-weight: 600;
}
@keyframes agent-active-pulse {
  0%, 100% { box-shadow: 0 0 8px var(--accent-glow); }
  50% { box-shadow: 0 0 20px var(--accent-glow), 0 0 6px var(--accent-muted); }
}

/* Complete state */
.agent-node.complete .agent-node-circle {
  border-color: var(--green);
  background: var(--green-muted);
  color: var(--green);
}
.agent-node.complete .agent-node-label {
  color: var(--green);
}

/* Skipped state */
.agent-node.skipped .agent-node-circle {
  border-color: var(--border);
  background: transparent;
  color: var(--text-muted);
  opacity: 0.4;
}
.agent-node.skipped .agent-node-label {
  opacity: 0.4;
}

/* Connector between nodes */
.agent-connector {
  flex: 1;
  height: 2px;
  background: var(--border);
  position: relative;
  min-width: 20px;
  transition: background 0.4s ease;
}
.agent-connector.complete {
  background: var(--green);
}
.agent-connector.active {
  background: linear-gradient(90deg, var(--green) 0%, var(--accent) 100%);
}

/* Status message below pipeline */
.agent-status-text {
  text-align: center;
  font-size: 11px;
  color: var(--text-secondary);
  margin-top: 8px;
  min-height: 16px;
  animation: status-fade 0.3s ease;
}
@keyframes status-fade {
  from { opacity: 0; transform: translateY(-4px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Mode badge variants */
.header-model-badge.langgraph {
  background: rgba(16, 185, 129, 0.15);
  color: #10b981;
}
.header-model-badge.direct {
  background: var(--accent-muted);
  color: var(--accent);
}

/* ══════════════════════════════════════
   Thinking Bar (collapsible, like Cursor)
   ══════════════════════════════════════ */

.thinking-bar {
  margin-bottom: 10px;
  border: 1px solid var(--border);
  border-radius: 10px;
  overflow: hidden;
  background: var(--bg-sidebar);
  transition: border-color 0.3s ease;
}
.thinking-bar.active {
  border-color: var(--accent);
  box-shadow: 0 0 0 1px var(--accent-muted);
}
.thinking-bar-header {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 14px;
  cursor: pointer;
  font-size: 12px;
  color: var(--text-muted);
  user-select: none;
  transition: background 0.15s ease;
}
.thinking-bar-header:hover {
  background: var(--bg-hover);
}
.thinking-dot {
  width: 7px;
  height: 7px;
  border-radius: 50%;
  background: var(--text-muted);
  flex-shrink: 0;
  transition: background 0.3s ease;
}
.thinking-dot.active {
  background: var(--accent);
  animation: thinking-pulse 1.5s ease-in-out infinite;
}
@keyframes thinking-pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.5; transform: scale(0.8); }
}
.thinking-label {
  flex: 1;
  font-weight: 500;
  letter-spacing: 0.01em;
}
.thinking-toggle {
  font-size: 10px;
  color: var(--text-muted);
  opacity: 0.6;
}
.thinking-bar-content {
  padding: 10px 14px;
  border-top: 1px solid var(--border);
  font-size: 12px;
  line-height: 1.6;
  max-height: 280px;
  overflow-y: auto;
  color: var(--text-secondary);
  background: rgba(0, 0, 0, 0.15);
}
.thinking-bar-content .markdown-content {
  font-size: 12px;
  line-height: 1.6;
}
.thinking-bar-content .markdown-content p {
  margin: 4px 0;
}
.thinking-bar-content .markdown-content strong {
  color: var(--text);
}
.thinking-bar-content::-webkit-scrollbar {
  width: 4px;
}
.thinking-bar-content::-webkit-scrollbar-track {
  background: transparent;
}
.thinking-bar-content::-webkit-scrollbar-thumb {
  background: var(--border);
  border-radius: 2px;
}
